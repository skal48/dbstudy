DROP TABLE LECTURE_TBL;
DROP TABLE ENROLL_TBL;
DROP TABLE STUDENT_TBL;
DROP TABLE COURSE_TBL;
DROP TABLE PROFESSOR_TBL;

CREATE TABLE PROFESSOR_TBL( --교수 번호도 시퀀스 X
    PROF_NO     NUMBER NOT NULL,
    PROF_NAME   VARCHAR2(10 BYTE) NOT NULL,
    PROF_MAJOR   VARCHAR2(50 BYTE) NOT NULL,
    CONSTRAINT PK_PROF PRIMARY KEY(PROF_NO)
);
    
CREATE TABLE COURSE_TBL(
    COUR_NO      NUMBER NOT NULL,
    COUR_NAME    VARCHAR2(50 BYTE) NOT NULL,
    COUR_CREDIT  NUMBER NOT NULL,
    CONSTRAINT PK_COUR PRIMARY KEY(COUR_NO)
);

CREATE TABLE STUDENT_TBL(  --학번 시퀀스 x ,과목번호도 X
    STU_NO      NUMBER(9) NOT NULL,
    STU_NAME    VARCHAR2(10 BYTE) NOT NULL,
    ADDRESS     VARCHAR2(100 BYTE) NOT NULL,
    GRADE       NUMBER NOT NULL CHECK(GRADE <= 4),
    PROF_NO     NUMBER ,
    CONSTRAINT PK_STU PRIMARY KEY(STU_NO),
    CONSTRAINT FK_PRO_STU FOREIGN KEY(PROF_NO) REFERENCES PROFESSOR_TBL(PROF_NO) ON DELETE SET NULL 
);

CREATE TABLE ENROLL_TBL(
    ENR_NO      NUMBER NOT NULL,
    STU_NO      NUMBER(9) NOT NULL,
    COUR_NO     NUMBER NOT NULL,
    ENR_DATE    DATE  NULL,
    CONSTRAINT PK_ENR PRIMARY KEY(ENR_NO),
    CONSTRAINT FK_STU_ENR FOREIGN KEY(STU_NO) REFERENCES STUDENT_TBL(STU_NO) ON DELETE CASCADE,
    CONSTRAINT FK_COUR_ENR FOREIGN KEY(COUR_NO) REFERENCES COURSE_TBL(COUR_NO) ON DELETE CASCADE
);

CREATE TABLE LECTURE_TBL(
    LECT_NO     NUMBER NOT NULL,
    PROF_NO     NUMBER NOT NULL,
    ENR_NO      NUMBER NOT NULL,
    LECT_NAME   VARCHAR2(50 BYTE) NOT NULL,
    ROOM_NO     NUMBER NOT NULL,
    CONSTRAINT PK_LECT PRIMARY KEY(LECT_NO),
    CONSTRAINT FK_PROF_LECT FOREIGN KEY(PROF_NO) REFERENCES PROFESSOR_TBL(PROF_NO) ON DELETE CASCADE,
    CONSTRAINT FK_ENR_LECT FOREIGN KEY(ENR_NO) REFERENCES ENROLL_TBL(ENR_NO) ON DELETE CASCADE
);

INSERT INTO PROFESSOR_TBL VALUES(4, '가나다',  '수의학');
INSERT INTO PROFESSOR_TBL VALUES(6, '마바사',  '수리');
INSERT INTO PROFESSOR_TBL VALUES(7, '아자차',  '신소재');

INSERT INTO COURSE_TBL VALUES(1011, '고분자의_이해', 4);
INSERT INTO COURSE_TBL VALUES(1027, '환경과_인간',   2);
INSERT INTO COURSE_TBL VALUES(1043, '공학수학',      3);

INSERT INTO STUDENT_TBL VALUES(201112109, '이우림', '서울',   1, 4);
INSERT INTO STUDENT_TBL VALUES(201924158, '홍길동', '인천',   4, 6);
INSERT INTO STUDENT_TBL VALUES(201715127, '황보람', '경기도', 2, 7);

DROP SEQUENCE ENR_SEQUENCE;

CREATE SEQUENCE ENR_SEQUENCE ORDER;

INSERT INTO ENROLL_TBL VALUES(ENR_SEQUENCE.NEXTVAL, 201715127, 1043, '2023/07/03');
INSERT INTO ENROLL_TBL VALUES(ENR_SEQUENCE.NEXTVAL, 201924158, 1027, '2023/07/03');
INSERT INTO ENROLL_TBL VALUES(ENR_SEQUENCE.NEXTVAL, 201112109, 1043, '2023/07/04');

DROP SEQUENCE LECT_SEQUENCE;

CREATE SEQUENCE LECT_SEQUENCE 
    START WITH 10001  
    ORDER;
    
INSERT INTO LECTURE_TBL VALUES(LECT_SEQUENCE.NEXTVAL, 4, ENR_SEQUENCE.CURRVAL, '오늘도', 105);
INSERT INTO LECTURE_TBL VALUES(LECT_SEQUENCE.NEXTVAL, 6, ENR_SEQUENCE.CURRVAL, '하루를', 107);
INSERT INTO LECTURE_TBL VALUES(LECT_SEQUENCE.NEXTVAL, 7, ENR_SEQUENCE.CURRVAL, '힘차게', 111);

COMMIT;
